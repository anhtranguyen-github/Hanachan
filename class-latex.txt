\subsection{Thiết kế lớp}

\subsubsection{Lớp FSRSEngine}
\textbf{Vai trò}: Lớp xử lý thuần túy (Pure Logic) chịu trách nhiệm thực thi thuật toán Free Spaced Repetition Scheduler. Đây là lõi toán học giúp dự báo thời điểm người dùng sắp quên kiến thức dựa trên mức độ ổn định của bộ nhớ.
\begin{table}[H]
\centering
\caption{Thiết kế lớp FSRSEngine}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
DEFAULT\_DIFFICULTY & Double & Độ khó mặc định cho kiến thức mới (3.0). \\
BURNED\_THRESHOLD\_DAYS & Integer & Ngưỡng thời gian (120 ngày) để coi kiến thức đã nhuần nhuyễn. \\
REVIEW\_THRESHOLD\_DAYS & Integer & Ngưỡng thời gian (3 ngày) để chuyển từ giai đoạn học sang ôn tập. \\
\hline
calculateNextReview() & NextReviewData & Tính toán ngày ôn tập tiếp theo và các chỉ số FSRS mới. \\
\hline
\end{tabular}
\end{table}

\subsubsection{Lớp ReviewSessionController}
\textbf{Vai trò}: Điều phối trạng thái của phiên ôn tập đang diễn ra. Đảm bảo quy tắc re-queue các mục trả lời sai và chỉ ghi nhận kết quả đánh giá cho lần thử đầu tiên của mỗi diện kiến thức (facet).
\begin{table}[H]
\centering
\caption{Thiết kế lớp ReviewSessionController}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
queue & List$<$QuizItem$>$ & Hàng đợi các mục kiến thức cần trả lời trong phiên. \\
completedCount & Integer & Số lượng mục đã hoàn thành trong phiên hiện tại. \\
firstAttemptDone & Set$<$String$>$ & Theo dõi các mục đã được người dùng thực hiện lượt trả lời đầu tiên. \\
\hline
initSession() & Promise$<$List$>$ & Khởi tạo phiên làm việc với danh sách các mục cần ôn tập. \\
submitAnswer() & Promise$<$Boolean$>$ & Xử lý câu trả lời và cập nhật trạng thái hàng đợi/tiến độ. \\
getNextItem() & QuizItem & Lấy mục tiếp theo từ hàng đợi để hiển thị lên giao diện. \\
getProgress() & SessionProgress & Trả về thông tin tiến độ của phiên hiện tại. \\
\hline
\end{tabular}
\end{table}

\subsubsection{Lớp LearningService}
\textbf{Vai trò}: Chịu trách nhiệm điều phối các hoạt động nghiệp vụ liên quan đến học tập và quản lý cấp độ (curriculum progression).
\begin{table}[H]
\centering
\caption{Thiết kế lớp LearningService}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
fetchNewItems() & Promise$<$List$>$ & Lấy danh sách các bài học mới theo cấp độ và giới hạn. \\
fetchDueItems() & Promise$<$List$>$ & Lấy các mục kiến thức đã đến hạn ôn tập. \\
checkAndUnlockNextLevel() & Promise$<$void$>$ & Kiểm tra Quy tắc 90\% để mở khóa cấp độ tiếp theo. \\
submitReview() & Promise$<$Data$>$ & Gửi kết quả ôn tập cuối cùng để lưu vào cơ sở dữ liệu và cập nhật SRS. \\
\hline
\end{tabular}
\end{table}

\subsubsection{Lớp KnowledgeUnit}
\textbf{Vai trò}: Lớp thực thể (Entity) đại diện cho một đơn vị kiến thức (Bộ thủ, Hán tự, Từ vựng, Ngữ pháp) trong hệ thống.
\begin{table}[H]
\centering
\caption{Thiết kế lớp KnowledgeUnit}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
id & UUID & Định danh duy nhất cho đơn vị kiến thức. \\
type & Enum & Phân loại: radical, kanji, vocabulary, grammar. \\
level & Integer & Cấp độ chứa đơn vị kiến thức này. \\
character & String & Mặt chữ hoặc ký hiệu của kiến thức. \\
meaning & String & Ý nghĩa chính của đơn vị kiến thức. \\
\hline
\end{tabular}
\end{table}

\subsubsection{Lớp AnalyticsService}
\textbf{Vai trò}: Chịu trách nhiệm thu thập và tổng hợp dữ liệu thống kê từ nhật ký học tập phục vụ hiển thị trên trang tổng quan (Dashboard).
\begin{table}[H]
\centering
\caption{Thiết kế lớp AnalyticsService}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
logReview() & Promise$<$void$>$ & Lưu nhật ký lượt ôn tập (đúng/sai, bài mới/cũ). \\
getDashboardStats() & Promise$<$Stats$>$ & Tổng hợp các số liệu: độ chính xác, tỷ lệ duy trì, dữ liệu heatmap. \\
\hline
\end{tabular}
\end{table}

\subsubsection{Lớp Hanachan}
\textbf{Vai trò}: Trợ lý ảo thông minh dựa trên từ khóa, thực hiện phân tích ý định người dùng và kết nối với kho tri thức Nhật ngữ.
\begin{table}[H]
\centering
\caption{Thiết kế lớp Hanachan}
\begin{tabular}{|p{4.5cm}|p{2.5cm}|p{7cm}|}
\hline
\rowcolor[HTML]{EFEFEF} \textbf{Thuộc tính / Phương thức} & \textbf{Kiểu dữ liệu} & \textbf{Mô tả} \\
\hline
process() & Promise$<$Agent$>$ & Xử lý tin nhắn người dùng và trả về phản hồi mô phỏng hội thoại. \\
determineIntent() & Enum & Xác định ý định người dùng: Tìm kiếm, Phân tích, hoặc Xem tiến độ. \\
\hline
\end{tabular}
\end{table}